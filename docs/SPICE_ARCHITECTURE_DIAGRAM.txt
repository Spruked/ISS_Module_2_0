
╔══════════════════════════════════════════════════════════════════════════════╗
║                    SPICE DESCRIPTOR LAYER ARCHITECTURE                       ║
║                  Constitutional Article VII Compliant                        ║
╚══════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────────┐
│                           ISS MODULE v2 (FastAPI)                           │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐    │
│  │   /time/*    │  │  /spice/*    │  │  /vault/*    │  │  /audit/*    │    │
│  │ Forensic API │  │ SPICE API    │  │ Ref API      │  │ Recon API    │    │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘    │
└─────────┼─────────────────┼─────────────────┼─────────────────┼────────────┘
          │                 │                 │                 │
          ▼                 ▼                 ▼                 ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                         SERVICE LAYER                                       │
│  ┌────────────────┐  ┌────────────────┐  ┌────────────────┐                │
│  │ ForensicTime   │  │ SPICEDescriptor│  │ AuditRecon     │                │
│  │ Service        │  │ Service        │  │ Service        │                │
│  └────────┬───────┘  └────────┬───────┘  └────────┬───────┘                │
└───────────┼───────────────────┼───────────────────┼────────────────────────┘
            │                   │                   │
            ▼                   ▼                   ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                         DATA LAYER (EXTERNAL TO VAULTS)                     │
│                                                                             │
│  ┌─────────────────────────────┐    ┌─────────────────────────────┐        │
│  │   FORENSIC TIME KEEPER      │    │   SPICE DESCRIPTOR LAYER    │        │
│  │   ┌─────────────────────┐   │    │   ┌─────────────────────┐   │        │
│  │   │ glyph_chain.jsonl   │   │    │   │ spice_descriptors.  │   │        │
│  │   │ (immutable pulses)  │   │    │   │ jsonl (metadata)    │   │        │
│  │   └─────────────────────┘   │    │   └─────────────────────┘   │        │
│  │   ┌─────────────────────┐   │    │   ┌─────────────────────┐   │        │
│  │   │ forensic_audit.log  │   │    │   │ spice_index.json    │   │        │
│  │   │ (constitutional)    │   │    │   │ (fast lookup)       │   │        │
│  │   └─────────────────────┘   │    │   └─────────────────────┘   │        │
│  └─────────────────────────────┘    └─────────────────────────────┘        │
│                                                                             │
│  [NON-COGNITIVE] [REFERENTIAL ONLY] [NON-AUTHORITATIVE] [IMMUTABLE]        │
└─────────────────────────────────────────────────────────────────────────────┘
            │                   ▲                   │
            │                   │                   │
            ▼                   │                   ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                         MEMORY MATRIX (READ-ONLY ACCESS)                    │
│                                                                             │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐             │
│  │  APRIORI VAULT  │  │ APSTERIORI VAULT│  │   TRACE VAULT   │             │
│  │  (Immutable     │  │ (Validated      │  │  (Glyph Chain   │             │
│  │   Truths)       │  │  Learning)      │  │   History)      │             │
│  │                 │  │                 │  │                 │             │
│  │ • deterministic │  │ • job_success   │  │ • pulse_001     │             │
│  │   _replay       │  │ • execution_time│  │ • pulse_002     │             │
│  │ • glyph_logging │  │ • pattern_recog │  │ • pulse_003...  │             │
│  └────────┬────────┘  └────────┬────────┘  └────────┬────────┘             │
│           │                    │                    │                       │
│           └────────────────────┴────────────────────┘                       │
│                              ▲                                              │
│                              │                                              │
│                    [REFERENCES ONLY - NO WRITE ACCESS]                      │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                         GHOST LAYER                                  │   │
│  │              (Decaying Semantic Wakes - Not Referenced)              │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
            ▲
            │
            │ INTEGRATION LAYER
┌───────────┼─────────────────────────────────────────────────────────────────┐
│           │                                                                 │
│  ┌────────┴────────┐  ┌────────┴────────┐  ┌────────┴────────┐             │
│  │   WORKER SKG    │  │    CALI ORB     │  │  DALS EXECUTION │             │
│  │                 │  │                 │  │                 │             │
│  │ Job execution   │  │ Cognitive       │  │ Action          │             │
│  │ with SPICE      │  │ processing with │  │ tracing with    │             │
│  │ metadata        │  │ SPICE audit     │  │ SPICE refs      │             │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘             │
└─────────────────────────────────────────────────────────────────────────────┘

╔══════════════════════════════════════════════════════════════════════════════╗
║                         AUDIT RECONSTRUCTION FLOW                            ║
╚══════════════════════════════════════════════════════════════════════════════╝

    Auditor Request
          │
          ▼
┌───────────────────┐
│ GET /audit/trail/ │
│ {descriptor_id}   │
└─────────┬─────────┘
          │
          ▼
┌───────────────────┐     ┌───────────────────┐
│  SPICE DESCRIPTOR │────▶│  What Happened?   │
│     LAYER         │     │  • Process name   │
│                   │     │  • Outcome        │
│  O(1) Lookup      │     │  • Glyph range    │
└─────────┬─────────┘     └───────────────────┘
          │
          ├──────────────────────────────────────┐
          ▼                                      ▼
┌───────────────────┐                  ┌───────────────────┐
│  Why It Happened? │                  │  How It Happened? │
│  • Apriori refs   │                  │  • Capability lvl │
│  • Constraints    │                  │  • Assessment     │
│  • Evidence       │                  │  • Compliance     │
└─────────┬─────────┘                  └─────────┬─────────┘
          │                                      │
          ▼                                      ▼
┌───────────────────┐                  ┌───────────────────┐
│ APRIORI VAULT     │                  │  SPICE Metadata   │
│ (follow refs)     │                  │  (already loaded) │
└───────────────────┘                  └───────────────────┘
          │
          ▼
┌───────────────────┐
│ What Was Learned? │
│ • Aposteriori refs│
│ • Advisory notes  │
└─────────┬─────────┘
          │
          ▼
┌───────────────────┐
│ APSTERIORI VAULT  │
│ (follow refs)     │
└───────────────────┘
          │
          ▼
┌───────────────────┐
│  FORENSIC TIMELINE│
│  (glyph range)    │
└───────────────────┘
          │
          ▼
┌───────────────────┐
│  COMPLETE AUDIT   │
│  TRAIL RESPONSE   │
│  • What/Why/How/  │
│    Learned        │
│  • Vault pointers │
│  • Timeline       │
└───────────────────┘

╔══════════════════════════════════════════════════════════════════════════════╗
║                    CONSTITUTIONAL SAFEGUARDS                                 ║
╚══════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────────┐
│  ⚖️  ARTICLE VII: ALL MEMORY IS IMMUTABLE AND AUDITABLE                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  SAFEGUARD 1: VAULT CONTAMINATION PREVENTION                        │   │
│  │  • SPICE layer opens vault files in READ-ONLY mode                  │   │
│  │  • File permissions: vaults = 444, spice_layer = 644                │   │
│  │  • Hash verification on startup                                     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  SAFEGUARD 2: NON-AUTHORITATIVE ENFORCEMENT                         │   │
│  │  • All descriptors flagged: "authority": "NON_AUTHORITATIVE"        │   │
│  │  • Cannot override vault decisions                                  │   │
│  │  • Advisory notes cannot contain "OVERRIDE" commands                │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  SAFEGUARD 3: IMMUTABILITY GUARANTEE                                │   │
│  │  • Descriptors append-only (JSONL format)                           │   │
│  │  • Index regenerated, never edited in-place                         │   │
│  │  • Chain verification detects any mutations                         │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  SAFEGUARD 4: EXTERNALITY MANDATE                                   │   │
│  │  • SPICE layer in separate directory from vaults                    │   │
│  │  • No cross-contamination possible                                  │   │
│  │  • Constitutional binding logged on init                            │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
